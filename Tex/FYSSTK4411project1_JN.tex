   \documentclass[%
oneside,                 % oneside: electronic viewing, twoside: printing
final,                   % draft: marks overfull hboxes, figures with paths
10pt]{article}

\listfiles               %  print all files needed to compile this document

\usepackage[a4paper, total={6in, 8in}]{geometry}
\usepackage[totoc]{idxlayout}   % for index in the toc
\usepackage[nottoc]{tocbibind}  % for references/bibliography in the toc

\usepackage{relsize,makeidx,color,setspace,amsmath,amsfonts,amssymb}
\usepackage[table]{xcolor}
\usepackage{bm,ltablex,microtype}
\usepackage{comment} 
\usepackage[pdftex]{graphicx}

\usepackage{fancyvrb} % packages needed for verbatim environments

\usepackage[T1]{fontenc}
%\usepackage[latin1]{inputenc}
\usepackage{ucs}
\usepackage[utf8x]{inputenc}

\usepackage{lmodern}         % Latin Modern fonts derived from Computer Modern


\usepackage{pgfplotstable, booktabs}

\pgfplotstableset{
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule}
}





% Hyperlinks in PDF:
\definecolor{linkcolor}{rgb}{0,0,0.4}
\usepackage{hyperref}
\hypersetup{
    breaklinks=true,
    colorlinks=true,
    linkcolor=linkcolor,
    urlcolor=linkcolor,
    citecolor=black,
    filecolor=black,
    %filecolor=blue,
    pdfmenubar=true,
    pdftoolbar=true,
    bookmarksdepth=3   % Uncomment (and tweak) for PDF bookmarks with more levels than the TOC
    }
%\hyperbaseurl{}   % hyperlinks are relative to this root

\setcounter{tocdepth}{2}  % levels in table of contents

% --- fancyhdr package for fancy headers ---
\usepackage{fancyhdr}
\fancyhf{} % sets both header and footer to nothing
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[LE,RO]{\thepage}
% Ensure copyright on titlepage (article style) and chapter pages (book style)
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyfoot[C]{{\footnotesize \copyright\ 1999-2018, "Computational Physics I FYS3150/FYS4150":"http://www.uio.no/studier/emner/matnat/fys/FYS3150/index-eng.html". Released under CC Attribution-NonCommercial 4.0 license}}
%  \renewcommand{\footrulewidth}{0mm}
  \renewcommand{\headrulewidth}{0mm}
}
% Ensure copyright on titlepages with \thispagestyle{empty}
\fancypagestyle{empty}{
  \fancyhf{}
  \fancyfoot[C]{{ }}
  \renewcommand{\footrulewidth}{0mm}
  \renewcommand{\headrulewidth}{0mm}
}

\pagestyle{fancy}


% prevent orhpans and widows
\clubpenalty = 10000
\widowpenalty = 10000

% --- end of standard preamble for documents ---


% insert custom LaTeX commands...

\raggedbottom
\makeindex
\usepackage[totoc]{idxlayout}   % for index in the toc
\usepackage[nottoc]{tocbibind}  % for references/bibliography in the toc
\usepackage{listings}
\usepackage[normalem]{ulem} 	%for tables
\useunder{\uline}{\ul}{}
\usepackage{hyperref}
\usepackage[section]{placeins} %force figs in section

\usepackage{natbib}

\usepackage[toc,page]{appendix} % appenix
\usepackage{amsmath} % split in align

%-------------------- end preamble ----------------------

\begin{document}

% matching end for #ifdef PREAMBLE

\newcommand{\exercisesection}[1]{\subsection*{#1}}


% ------------------- main content ----------------------



% ----------------- title -------------------------

\thispagestyle{empty}

\begin{center}
{\LARGE\bf
\begin{spacing}{1.25}
VMC%
\end{spacing}
}
\end{center}

% ----------------- author(s) -------------------------

\begin{center}
{\bf Johan Nereng}
\end{center}

    \begin{center}
% List of all institutions:
\centerline{{\small Department of Physics, University of Oslo, Norway}}
\end{center}
    
% ----------------- end author(s) -------------------------

% --- begin date ---
\begin{center}
March 23, 2020
\end{center}
% --- end date ---

\vspace{3cm}
\vspace{3cm}
\begin{abstract}


\end{abstract}


\newpage


\textit{\textbf{Author's comments:} .}
\newpage

\section{Introduction}
Want to evaluate ground-state energy of a Bose gas. The system is described by a Hamiltonian H. If we knew the wave function which corresponds to the ground-state energy, this would be a straight forward matter of simply applying the Hamiltonian to said wave function. However, since the exact wave function is not known, I use a trial wave function with adjustable parameters together with the so called Variational Monte Carlo method in order to zero in on the right ground-state energy. Alternatively, one could solve the Schrõdinger equation for the system, 

For et system av N partikler beskrevet av H, ønsker vi å finne den laveste energien systemet kan ha. Den mest direkte måten å gjøre dette på er å Schrõdinger-ligningen for systemet. (Dette krever
vel en bølgefunksjon, og det har vi ikke ?) - altså sannsynlighetsfordelingen til partiklene i Bose-gassen. Since we do not 

Single particle-funksjon som er laveste tilstanden for en harmonisk oscillator.

For flere partikler om det er boson. Alle partiklene er i laveste singelpartikkel tilstand. Bytter vi rekkefølge på et system av Bosoner endres ikke bølgefunksjonen. Bytter vi partikler for ferminoer endres fortegnet. 

Skal finne laveste egenpar.  Tilhørende en hamilton for en type partikkeltype. Ikke mulig å løse for SChrødoinger ligner for flere partikler og interaksjon. Bruker VMC. 

finner ikke varianse = 0, kan få lav med ulik alfa, men det betyr at bølgefunksjone ikke er fukllstendig fysisk. Den er nære. 

Spinn lik 0-system. Total bølgefunksjon symmetrisk. Indentical particles. ferminivå zlater

lese hamonisk oscillator

Pull fra MOrten. Kan skru på O3 når jeg veit at koden kjører slik den skal.


In order to write this project paper and the code required to produce the results, I used a variety of tools, including: Python 3.7.5, NumPy \cite{numpy}, , as well as a number of books, web-pages and articles - of which most are listed under 
 \hyperref[refer]{references}. All the code required to reproduce the results may be found on my \href{https://github.com/johanere/FYS-STK4155/tree/master/Project3}{github page }.  


Hard sphere Bose gas for various number of particles. Bose gas is a quantum mechanical phase of matter composed of bosons, which means that multiple particles may occupy the quantum state, in this case the ground state.

\textit{The mean square vibrational amplitude of a single boson at $T=0K$ in the trap (\ref{trap_eqn}) is
 $\langle x^2\rangle=(\hbar/2m\omega_{ho})$ so that $a_{ho} \equiv
 (\hbar/m\omega_{ho})^{\frac{1}{2}}$ defines the characteristic length
 of the trap. }
 
The aim is to evaluate the ground-state of the system;
\begin{equation*}
E_0 \Psi_o = H \Psi_o
\end{equation*}
 However, for complex very hard blabla. first outline system, then lblab
 
\section{Material and methods} \label{theory}
\subsection{System and physical quantities}
The system consists of $N$ bosons in an harmonic spherical (S) ($\omega_{ho}^2=\omega_z^2$) or elliptical (E) ($\omega_{ho}^2 \neq \omega_z^2$) trap \eqref{trap_eqn};
\begin{equation}
 V_{ext}(\mathbf{r}) = 
 \Bigg\{
 \begin{array}{ll}
	 \frac{1}{2}m\omega_{ho}^2r^2 & (S)\\
 \strut
	 \frac{1}{2}m[\omega_{ho}^2(x^2+y^2) + \omega_z^2z^2] & (E)
 \label{trap_eqn}
 \end{array}
 \end{equation}
, where $\omega_{ho}$ and  $\omega_z$ are trap frequencies in the xy plane and z direction respectively. The Hamiltonian of the system is given by
\begin{equation}
     H = \sum_i^N \left(\frac{-\hbar^2}{2m}{\bigtriangledown }_{i}^2 +V_{ext}({\mathbf{r}}_i)\right)  +
	 \sum_{i<j}^{N} V_{int}({\mathbf{r}}_i,{\mathbf{r}}_j),
	 \label{eq:hamiltonian}
 \end{equation}
where inter-boson interaction is given by the repulsive force prohibiting particles to come within a distance $a$ of other particles;
\begin{equation}
 V_{int}(|\mathbf{r}_i-\mathbf{r}_j|) =  \Bigg\{
 \begin{array}{ll}
	 \infty & {|\mathbf{r}_i-\mathbf{r}_j|} \leq {a}\\
	 0 & {|\mathbf{r}_i-\mathbf{r}_j|} > {a}
 \end{array}
 \end{equation}

In order to evaluate the ground-state energy trial wave function (TWF) is used \eqref{eq:trialwf}, where $\alpha$ and $\beta$ are variational parameters used to tune the wave function towards ground-state (more under a the \hyperref[S:VMC]{section on VMC}).

\begin{equation}
 \Psi_T(\mathbf{r})=\Psi_T(\mathbf{r}_1, \mathbf{r}_2, \dots \mathbf{r}_N,\alpha,\beta)
 =\left[
    \prod_i g(\alpha,\beta,\mathbf{r}_i)
 \right]
 \left[
    \prod_{j<k}f(a,|\mathbf{r}_j-\mathbf{r}_k|)
 \right],
 \label{eq:trialwf}
\end{equation}
Where
\begin{equation}
    g(\alpha,\beta,\mathbf{r}_i)= \exp{[-\alpha(x_i^2+y_i^2+\beta z_i^2)]}.
 \end{equation}
is the non-interactive part of the wave function, and 
\begin{equation}
    f(a,|\mathbf{r}_i-\mathbf{r}_j|)=\Bigg\{
 \begin{array}{ll}
	 0 & {|\mathbf{r}_i-\mathbf{r}_j|} \leq {a}\\
	 (1-\frac{a}{|\mathbf{r}_i-\mathbf{r}_j|}) & {|\mathbf{r}_i-\mathbf{r}_j|} > {a}.
 \end{array}
 \end{equation}
the interactive part, which by definition renders the repulsive force unnecessary in modeling the system as any breach of the particle spacing $a$ results in a wave function evaluation of zero.


\subsection{Local energy and drift force}
As previously mentioned, the aim is to evaluate the ground-state of the system. A crucial part of this is to evaluate the local energy (more on the application later), which is defined as
\begin{equation}
    E_L(\mathbf{r})=\frac{1}{\Psi_T(\mathbf{r})}H\Psi_T(\mathbf{r}).
    \label{eq:locale}
 \end{equation}
 
The variational method which will be used to find the ground-state of the system involves calculating this quantity repeatedly. This means that every reduction of floating point operation (FLOP) involved in doing so leads to a significant speed up - which is why an analytical expression for the local energy is desirable. As will be discussed more under \hyperref[importance_sampling]{importance sampling}, the drift force of the  particles are also needed;

\begin{equation}
F_i = \frac{2\nabla \Psi_T}{\Psi_T}
\end{equation} 

\subsubsection{Local energy and drift force: Non-interacting boson sphere}
For a spherical harmonic oscillator with no interaction between particles, $a=0$ and $\beta = 1$, the TWF \eqref{eq:trialwf} reduces to;
\begin{equation}
\Psi_T (\bm r)= \left[
    \prod_i g(\alpha,\beta,\mathbf{r}_i)
 \right]
\end{equation}

Thus simplifying the expression for the calculation for the local energy \eqref{eq:locale} to;
\begin{equation*}
    E_L(\mathbf{r}) =\frac{1}{ 
    \prod_i g(\alpha,\beta,\mathbf{r}_i)
}  \sum_i^N \left(\frac{-\hbar^2}{2m}{\nabla }_{i}^2 +\frac{1}{2}m\omega_{ho}^2r^2 \right)  \left[
    \prod_i g(\alpha,\beta,\mathbf{r}_i)
 \right]
 \end{equation*}

which leads to (see \hyperref[APP_1:le_1]{Appendix 1: Analytic local energy, non-interacting spherical}) the following expression when using natural units, $\hbar = c = 1 $, and unity mass, $m=1$;

\begin{equation}
        E_L(\mathbf{r}) =  \alpha d N + \left( - 2 \alpha    + \frac{1}{2} \omega_{ho}^2\right)  \sum_i^N r_i^2 .
\label{eq:locale_analytic_1}
\end{equation}

With drift force;
\begin{equation}
F_i = \frac{2\nabla \Psi_T}{\Psi_T}= -4\alpha \mathbf{r}_i 
\end{equation}
 
\subsubsection{Local energy and drift force: interacting boson sphere}
Concerning a general boson sphere, an analytic expression for the local energy of an elliptical trap with particle interaction, $\beta\neq 1$ and $a \neq 0$, is required. In order to derive it, the TWF \eqref{eq:trialwf} is re-written. First, the non-interactive part; 
\begin{equation*}
    g(\alpha,\beta,\mathbf{r}_i) = \exp{\left[-\alpha(x_i^2+y_i^2+\beta
    z_i^2)\right]}= \phi(\mathbf{r}_i) = \phi_i.
\end{equation*}

Secondly, the interactive part;

\begin{equation}
\prod_{i<j} f(r_{ij})= \exp{\left(\sum_{i<j}u_{jk}\right)}
\end{equation}
Where $u_{jk}=\ln{f(r_{ij})}$, using the shorthand notation $r_{ij}=|\mathbf{r}_i-\mathbf{r}_j|$. Thus, the WTF \eqref{eq:trialwf} is expressed as;

\begin{equation*}
\Psi_T(\mathbf{r})=\left[
    \prod_i \phi_i
\right]
\exp{\left(\sum_{j<k}u_{jk}\right)}
\end{equation*}
Which means that the local energy, using natural units and unity mass as before, \eqref{eq:locale} can be written as

\begin{equation}
    E_L(\mathbf{r}) =\frac{1}{ 
    \left[
    \prod_i \phi_i
\right]
\exp{\left(\sum_{j<k}u_{jk}\right)}
}  \sum_i^N \left(\frac{1}{2}{\nabla }_{i}^2 +\frac{1}{2}\omega_{ho}^2r^2 \right)  \left[
    \prod_i \phi_i
\right]
\exp{\left(\sum_{j<k}u_{jk}\right)}
\end{equation}
where (see \hyperref[APP_1:le_2]{Appendix 1: Analytic local energy, interacting elliptical})
\begin{align}
\begin{split}
\frac{1}{\Psi_T(\mathbf{r})} \nabla_k^2\Psi_T(\mathbf{r}) 
&=
\frac{\nabla_k^2 \phi_k}{\phi_k} + 2  \frac{\nabla_k \phi_k}{\phi_k} \sum_{l\ne k}\frac{\bm r_k - \bm r_l}{r_{kl}}  u'_{kl}  \\
&+  \sum_{j\ne k} \sum_{l\ne k} \frac{(\bm r_k - \bm r_l)(\bm r_k - \bm r_j)}{r_{kj} r_{kl} }  u'_{kj}  u'_{kl} \\
&+ \sum_{l\ne k} \left(   u{''}_{kl} + \frac{2}{r_{kl}}   u'_{kl} \right)
\end{split}
\end{align}
Thus
\begin{align}
\begin{split}
    E_L(\mathbf{r}) &= \frac{1}{2}\sum_{k=1}^N \left(\frac{\nabla_k^2 \phi_k}{\phi_k} 
    + 2 \frac{\nabla_k \phi_k}{\phi_k} \sum_{l\ne k}\frac{\bm r_k - \bm r_l}{r_{kl}}  u'_{kl}
    +  \right( \sum_{j\ne k}  \frac{(\bm r_k - \bm r_j)}{r_{kj} }  u'_{kj} \left)^2
    +  \sum_{l\ne k} \left(   u{''}_{kl} + \frac{2}{r_{kl}}   u'_{kl} \right) +\omega_{ho}^2r_k^2 \right)  
\end{split}
\end{align}
This expression is calculated piecemeal in the implementation, using that
\begin{align*}
\frac{\nabla_k \phi_k}{\phi_k} &=-2\alpha (x_k \vec e_1 + y_k \vec e_2 + \beta z_k \vec e_3), \\
\frac{\nabla_k^2 \phi_k}{\phi_k}&=-2\alpha (d-1+\beta)+4\alpha^2 (x_k   + y_k^2 + \beta^2 z_k^2), \\
\frac{\partial u_{kl}}{\partial r_{kl}}&= \frac{a}{r_{kl}(r_{kl}-a)}, \\
\frac{\partial^2 u_{kl}}{\partial r^2_{kl}}&= \frac{a^2-2ar_{kl}}{r_{kl}^2(r_{kl}-a)^2}
\end{align*}
And drift force;
\begin{equation*}
F_k = \frac{2\nabla \Psi_T}{\Psi_T}= 2 \left(\ \frac{\nabla_k \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k u_{kl} \right) 
\end{equation*}
Where $\nabla_k u_{kl}=\frac{\bm r_k - \bm r_l}{r_{kl}}\frac{\partial u_{km}}{\partial r_{km}}$
\subsection{variational principle and VMC} \label{S:VMC}
There are a multitude of methods available to circumnavigate having to directly solve the Schrõdinger equation in order to find the eigenpair of the system we are looking for (CITE!). An important underlying principle for the methods employed in this project is the variational principle \citep{Griffiths95}[p.256.]; 

\begin{equation}
E_0\leq E[H]= \langle H \rangle = \langle \Psi | H | \Psi \rangle
\end{equation}

This principle states that given a Hamiltonian, $H$, the ground-state energy, $E_0$, is upper bound by the expectation value $\langle H \rangle $, and holds for any normalized function $\Psi$. Thus, by using the Hamiltonian of the Bose gas, and trial wave function described earlier with variational parameters $\bm \alpha$, it possible to hone in on the minimal value of $\langle H \rangle$ and the desired ground-state energy, $E_0$, by solving the integral \footnote{Since $\Psi_T$ is not normalized, but normalizable, the favefunction $\frac{\Psi_T(\bm r)}{\sqrt{\int d\bm r \Psi_T^* (\bm r) \Psi_T(\bm r)}}$, is normalized};

\begin{equation}
E[H,\bm \alpha] = \langle H \rangle = \frac{\int d \bm r \Psi_T^* ( \bm r,\bm \alpha) H(\bm r) \Psi_T ( \bm r, \bm \alpha)}{\int d \bm r \Psi_T^* ( \bm r, \bm \alpha) \Psi_T ( \bm r, \bm \alpha)}.
\end{equation}

\textit{Direct dependence on $\bm \alpha$ is omitted from the rest of this paper, but is included here to show that the energy also depends on the variational parameters.}

Instead of solving this multi-dimentional integral analytically, which for anything than a single particle becomes complicated, if not impossible, I've used Monte Carlo integration. Monte Carlo integration \citep{CMP}[Ch. 3] is a stochastic method aimed at evaluating a deterministic, high dimensional, integral $I_M$. This involves drawing a sequence of $i=1,...,M$ random evens with a probability $P_i$, multiplying each event by it's probability, and taking the average - which will converge to $I_M$. The following shows this method applied to evaluating the ground-state in question;

\begin{equation}
E[H]=\int P(\bm r) E_L(\bm r) \approx \frac{1}{M}\sum_{i=1}^M P(\bm r_i) E_L(\bm r_i)
\end{equation}
, where $E_L(\bm r_i)$ \eqref{eq:locale} is the local energy of the system in configuration $\bm r_i$, and $P(\bm r_i)$ the probability of that local energy.

\begin{equation}
P(\bm r)=\frac{|\Psi_T (\bm r) |^2}{\int |\Psi_T (\bm r)|^2 d\bm r }
\label{eq:PDF}
\end{equation}


\subsubsection{Metropolis algorithm}
The Metropolis algorithm \citep{CMP}[p.86-88] is a highly adaptable method which generates a sequence of random samples from a probability distribution. The method makes iterative changes to a single degree of freedom and either accepts or rejects each change. By using the relative probability between samples, the method does not rely on directly sampling from a probability distribution, making the methods well suited for problems which involve complex probability distributions. 
The probability of the system being in state $i$ at time $t+\epsilon$ can be expressed through the probabilities of all states at time $t$; $P_i(t+\epsilon)=\sum_j w(j\rightarrow i)P_j(t)$, where $w(j\rightarrow i)$ is the transition probability from $j$ to $i$.  \eqref{eq:PDF} can be used to find the probability density, but the transition probabilities are unknown. These probabilities can be expressed as $w(j\rightarrow i)=A(j\rightarrow i) T(j\rightarrow i)$, where $T$ is the likelihood of making a transition, and $A$ the likelihood of that transition being accepted. The Metropolis algorithm works by initializing the system is a certain state, then using a random walker to suggest new states. By assuming $T(j\rightarrow i)=T(i\rightarrow j)$, or what is known as detailed balance \citep{CMP}[p.86], one obtains; \begin{align*}
\frac{P_i}{P_j}= \frac{W(j\rightarrow i)}{W(i\rightarrow j}= \frac{A(j\rightarrow i)T(j\rightarrow i)}{A(i\rightarrow j)T(i\rightarrow j)}=\frac{A(j\rightarrow i)}{A(i\rightarrow j)}.
\end{align*}
Using the probability ratio means that normalization is unnecessary, but more importantly this ratio also tells whether or not the random walker is moving into a region of high probability. Since the acceptance probability is unknown, brute force Metropolis uses $A(j\rightarrow i)=min(1,\frac{P_i}{P_j})$. The adaptation of the algorithm used in this project reads as; 

\begin{center}\fbox{\parbox{\textwidth}{{\textbf{MCMC: Brute Force Metropolis algorithm}}
\begin{enumerate}
\item Initialize algorithm
\subitem - Set the number of Monte Carlo cycles, $M$, and step length, $l$
\subitem - Set variational parameters $\bm \alpha$ 
\subitem - Set particle positions, $\vec r$
\subitem - Set energy $E=E_L(\vec r)$
\item Propose new configuration
\subitem - Select random particle 
\subitem - Randomly move particle up to a threshold \textit{l}. Store proposed particle position $\vec r*$
\item Evaluate proposal
\subitem - Calculate $w=\frac{P(\vec r*)}{P(\vec r)}=\frac{|\Psi_T (\vec r*)|^2}{|\Psi_T(\vec r)|^2}$
\subitem - Generate a random number $q$ between $0$ and $1$. 
\subitem - If $w \geq q$, accept proposal, calculate $E_L$ and set $E=E+E_L$. Else, reject proposal.
\item If the number of cycles from step $2$ to $4$ is less than $M$, go to step 2. Else calculate $\langle H \rangle = \frac{E}{M}$ and end simulation.  
\end{enumerate}}}\end{center}
\subsection{importance sampling} \label{importance_sampling}
A problem with the brute force methodology described above is that one may end up with a lot of proposed configurations from regions of relatively lower probability, or in other words, wasted cycles. A strategy to combat this is 

In order to not waste cycles on drawing too many samples that are not accepted,Don't want to draw samples from regions where the wave function is zero - these are wasted cycles.
That means modeling transition probability, $T$, and not assuming $T(i\rightarrow j)=T(j\rightarrow i)$.
$T(i\rightarrow j)$ can be modeled in many ways. Instead of picking a step size and take random steps, we let the random walker propose states after a specific distribution. Has longer CPU time per cycle, but a lot high acceptance rate. 

Fokker-Planck equation, which comes from fluid mechanics, which gives analyical solution for T, since numerical slows down program. T has time and spacial dependence.
Standard diffusion equation
\begin{equation}
\frac{\partial T}{\partial t} = D (\frac{\partial^2}{\partial x^2}-F) T(x,t)
\end{equation}
Fokker Planck comes from diffusion eq. (CITE derivation)
The convergence to a stationary state, or equilibrium state, or most likely state at $dT/dt=0$. 
So \begin{equation}
\frac{\partial^2}{\partial x_i^2} T(x,t) = T \frac{\partial}{\partial x_i} F_i + F_i \frac{\partial }{\partial x_i} T
\end{equation}
if we take $\vec all$ $F= g(x) \partial T/\partial x$
we get
So \begin{equation}
\frac{\partial^2}{\partial x_i^2} T(x,t) = T \frac{\partial g }{\partial x_i}( \frac{\partial T }{\partial x_i})^2  + T g  \frac{\partial^2 T }{\partial x_i^2} + g(\frac{\partial T}{\partial x_i})^2
\end{equation}
Which means that 
\begin{equation}
g=\frac{1}{T}
\end{equation}
So, $F=\frac{1}{\Psi}\vec \nabla \Psi$


The solution to the Fokker-Planck equation using this $F$ can be approximated by the Green's function;
\begin{equation}
T(x,y,t) = \frac{1}{4 \pi D \Delta t} exp\left(-\frac{(y-x-D\Delta t F(x))^2}{4D\Delta t}\right)
\end{equation}) 
where $\Delta t$ is a parameter


Metropolis hastings
$A(x\rightarrow )=T(x\rightarrow y)=\frac{T(x\rightarrow y) \Psi_T(y)|^2 }{T(y\rightarrow x)|\Psi_T(x)|^2}$

Instead of randomly moving the particle. The time evolution of the walker is described by the stochastic differential equation
\begin{equation}
\frac{\partial x(t)}{\partial t}=DF(x(t)) + \eta
\end{equation}
where $\eta$ is noise, which has the can be used to find the next position by euler's method;
$y=x+DF(x)\Delta t + \xi \sqrt{\Delta t}$

$q=\frac{G(y,g,t)|\Psi_T(y)|^2}{G(x,y,t)|\Psi_T(x)|^2}$


numerically; G/G can be shortened a lot. Precalc exp(-y) etc.

computational aspects
$\Psi_t=\Psi_{OB} \Psi_C$
OB - one body - product of all the single particle wfs 
Jastrow factor - C for correlation /correlated part. 
For ratio in Metropolis test (without importance sampling):
splitt opp ratio, $|psi|^2/|psi|=psi_{ob}|^2 \psi_c|^2..$


Variance used to determine how close (CITE) - if not it's impossible to tell how close we are. rather, need a method to de4termine how close we are.


By adjusting the parameters of the trial wave function described earlier, the variational principle 


In order to evaluate the ground-state energy of the Bose gas without solving the 
The variational  ground-state energy of a system which is described by the Hamiltonian H i
 
\subsection{importance sampling} \label{importance_sampling}

\subsubsection{evaluating correlation ratio}


 
 
 
One needs to develop a special algorithm that runs only through the elements of the upper triangular matrix g and have k as an index. 
\section{Results} \label{results}

\section{Conclusions} \label{conclusions}
Repulsive force trengs ikke pga wavefunc =0, men kan ende opp med å kaste bort en hel haug av mc cycles?

min E[H] på $\vec alpha$
Noe av MC skal være expectation
legg til varianse
anzatz is exp(...). Noramlization not required., as it sdissapears in the metropolis step.
\bibliography{ref} \label{refer}
\bibliographystyle{plain}


\begin{appendices}
\section*{Appendix 1.} \label{APP_1}
\subsection*{Analytic local energy, non-interacting spherical} \label{APP_1:le_1}
Gradient of $g$:
\begin{equation*}
{\nabla }_{i} g(\alpha,\beta,\mathbf{r}_i)=-2\alpha \mathbf{r}_i g(\alpha,\beta,\mathbf{r}_i)
\end{equation*}
Laplacian of $g$:
From the product rule, derivation of $ \mathbf{r}_i$, gives a coefficient $d$ representing the dimensionality of $r$. 
\begin{equation*}
{\nabla }_{i}^2  g(\alpha,\beta,\mathbf{r}_i)=  (-2d \alpha  + 4 \alpha  \mathbf{r}_i^2) g(\alpha,\beta,\mathbf{r}_i)
\end{equation*}
Meaning that
\begin{equation*}
        E_L(\mathbf{r}) =  \sum_i^N \left(\frac{-\hbar^2}{2m}(-2 d \alpha + 4 \alpha  \mathbf{r}_i^2) + \frac{1}{2}m\omega_{ho}^2r_i^2 )\right)  
 \end{equation*}
Using natural units, $\hbar=c=1$, and unity mass $m=1$, the equation becomes;

\begin{equation*}
        E_L(\mathbf{r}) =  \alpha d N + \left( - 2 \alpha    + \frac{1}{2} \omega_{ho}^2\right)  \sum_i^N r_i^2 
\end{equation*}

And using the gradient of $g$, the drift force is
\begin{equation*}
F_i = \frac{2\nabla \Psi_T}{\Psi_T}= -4\alpha \mathbf{r}_i 
\end{equation*}

\subsection*{Analytic local energy, interacting eliptical} \label{APP_1:le_2}
Starting with
\begin{equation*}
    E_L(\mathbf{r}) =\frac{1}{ 
    \left[
    \prod_i \phi_i
\right]
\exp{\left(\sum_{j<k}u_{jk}\right)}
}  \sum_i^N \left(\frac{-\hbar^2}{2m}{\nabla }_{i}^2 +\frac{1}{2}m\omega_{ho}^2r^2 \right)  \left[
    \prod_i \phi_i
\right]
\exp{\left(\sum_{j<k}u_{jk}\right)}
 \end{equation*}
With the first goal being to calculate the term
\begin{equation*}
   \frac{1}{\Psi_T(\mathbf{r})}\sum_i^{N}\nabla_i^2\Psi_T(\mathbf{r}),
\end{equation*}
starting by taking the gradient with respect to the k'th particle;
\begin{align*}
  \nabla_k\Psi_T(\mathbf{r}) &= \nabla_k \left(\left[
    \prod_i \phi_i
\right]
\exp{\left(\sum_{j<m}u_{jm}\right)}\right) \\
 &= \left( \nabla_k \left[
    \prod_i \phi_i
\right] \right)
\exp{\left(\sum_{j<m} u_{jm}\right)} +
\left[
    \prod_i \phi_i
\right]
\left( \nabla_k \exp{\left(\sum_{j<m} u_{jm} \right)}\right) \label{AA_gradfullTW}
\end{align*}
The gradient of the non-interacting part of the TW:
\begin{align}
\begin{split}
& \nabla_k \left[
    \prod_i \phi_i
\right] =  \nabla_k \phi_k \left[
    \prod_{i\neq k} \phi_i
\right]= \nabla_k \phi_k \frac{\prod_i g(\alpha,\beta,\mathbf{r}_i)}{\phi_k} \\
\end{split}
\end{align}
And the gradient of the interacting part, remembering that $r_{kl}=r_{lk}$;
\begin{align}
\nabla_k \exp{\left(\sum_{j<m} u_{jm} \right)}
= \exp{\left(\sum_{j<m} u_{jm} \right)} \sum_{j\neq k} \nabla_k u_{kj}
=  \prod_{j<m} f(r_{jm}) \sum_{l\neq k} \nabla_k u_{kl}
\end{align}

Thus \eqref{AA_gradfullTW} is
\begin{align}
\begin{split}
  \nabla_k\Psi_T(\mathbf{r}) &= \nabla_k\phi_k\left[\prod_{i\ne k}\phi_i\right]\exp{\left(\sum_{j<m}u_{jm}\right)}
  \\
  &\qquad
  +  \left[\prod_i\phi_i\right]
  \exp{\left(\sum_{j<m}u_{jm}\right)}\sum_{l\ne k}\nabla_k u_{kl}
\end{split}
\end{align}
or

\begin{align}
\begin{split}
  \nabla_k\Psi_T(\mathbf{r}) &=\nabla_k \phi_k \frac{\prod_i g(\alpha,\beta,\mathbf{r}_i)}{\phi_k}\prod_{j<m} f(r_{jm})
  \\
  &\qquad
  +  \prod_i  g(\alpha,\beta,\mathbf{r}_i)
 \prod_{j<m} f(r_{jm})\sum_{l\ne k}\nabla_k u_{kl} \\
&= \left(\ \frac{\nabla_k \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k u_{kl} \right) \Psi_T(\mathbf{r})  
\end{split}
\label{eq:A1_gradpsi}
\end{align}
Next, the above expressions are used to find the second derivative;

\begin{align}  
\begin{split}
\frac{1}{\Psi_T(\mathbf{r})} \nabla_k^2\Psi_T(\mathbf{r}) 
&=
\frac{1}{\Psi_T(\mathbf{r})} \nabla_k\left( \left(\frac{\nabla_k \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k u_{kl} \right) \Psi_T(\mathbf{r}) \right)\\
&=
\frac{1}{\Psi_T(\mathbf{r})} \left(\left(\phi_k \nabla_k\frac{1}{\phi_k} +\frac{\nabla_k^2 \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k^2 u_{kl} \right)\Psi_T(\mathbf{r}) + 
\left(\ \frac{\nabla_k \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k u_{kl} \right)^2 \Psi_T(\mathbf{r})   \right) \\
&=
 \left(\ \frac{\nabla_k \phi_k}{\phi_k} \right)^2 + \frac{\nabla_k^2 \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k^2 u_{kl}  + 
\left(\ \frac{\nabla_k \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k u_{kl} \right)^2 \\
&=
 -\left(\frac{\nabla_k \phi_k}{\phi_k}\right)^2 + \frac{\nabla_k^2 \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k^2 u_{kl}  + 
\left(\ \frac{\nabla_k \phi_k}{\phi_k} \right)^2 + 2\left(\ \frac{\nabla_k \phi_k}{\phi_k} \sum_{l\ne k}\nabla_k u_{kl} \right)+ \left(\ \sum_{l\ne k}\nabla_k u_{kl} \right)^2 \\
&= 
\frac{\nabla_k^2 \phi_k}{\phi_k} + 2  \frac{\nabla_k \phi_k}{\phi_k} \sum_{l\ne k}\nabla_k u_{kl} + \sum_{l\ne k}\nabla_k^2 u_{kl}   + \left(\ \sum_{l\ne k}\nabla_k u_{kl} \right)^2
\end{split}      
\end{align}
In order to simplify applying the $\nabla_k$-operator to $u_{kl}$, the operator is re-written:
\begin{align*}
\nabla_k = \nabla_k \frac{\partial r_{kl}}{\partial r_{kl}} = \nabla_k \sqrt{\left(\bm r_k - \bm r_l \right)^2} \frac{\partial}{\partial r_{kl}} = \frac{\bm r_k - \bm r_l}{r_{kl}} \frac{\partial}{\partial r_{kl}}
\end{align*}
This re-written operator is then applied to the $\nabla_k u_{kl}$ terms, such that
\begin{align*}
\nabla_k u_{kl} = \frac{\bm r_k - \bm r_l}{r_{kl}} \frac{\partial u_{kl}}{\partial r_{kl}} = \frac{\bm r_k - \bm r_l}{r_{kl}}  u'_{kl}
\end{align*}
And
\begin{align*}
\nabla_k^2 u_{kl} 
&= \left( \nabla_k  \frac{\bm r_k - \bm r_l}{r_{kl}} \right) \partial u'_{kl}  +  \frac{\bm r_k - \bm r_l}{r_{kl}} \left( \nabla_k   u'_{kl}  \right) \\
&=  \left( \frac{ \nabla_k (\bm r_k - \bm r_l)}{r_{kl}} \right)  u'_{kl}  +   (\bm r_k - \bm r_l) \left( \nabla_k \frac{1 }{r_{kl}} \right)  u'_{kl}  +  \frac{\bm r_k - \bm r_l}{r_{kl}} \left( \nabla_k   u'_{kl}  \right) \\
&= 
\frac{d}{r_{kl}}   u'_{kl}  -  (\bm r_k - \bm r_l) \frac{(\bm r_k - \bm r_l)}{r_{kl}^3}   u'_{kl} 
+  \left( \frac{\bm r_k - \bm r_l}{r_{kl}} \right)^2   u{''}_{kl} \\
&= 
\left( \frac{d}{r_{kl}}   -   \frac{(\bm r_k - \bm r_l)^2}{r_{kl}^3} \right)  u'_{kl} 
+  \left( \frac{\bm r_k - \bm r_l}{r_{kl}} \right)^2   u{''}_{kl}
\end{align*}
Where $(\bm r_k - \bm r_l)^2={r_{kl}}^2$, thus
\begin{align*}
\nabla_k^2 u_{kl} 
&=
\left( \frac{d}{r_{kl}}   -   \frac{1}{r_{kl}} \right)  u'_{kl} 
+    u{''}_{kl} =   \frac{d-1}{r_{kl}}   u'_{kl} 
+    u{''}_{kl}
\end{align*}
Applied to the Laplacian;
\begin{align}
\begin{split}
\frac{1}{\Psi_T(\mathbf{r})} \nabla_k^2\Psi_T(\mathbf{r}) 
&=
\frac{\nabla_k^2 \phi_k}{\phi_k} + 2  \frac{\nabla_k \phi_k}{\phi_k} \sum_{l\ne k}\frac{\bm r_k - \bm r_l}{r_{kl}}  u'_{kl}  \\
&+  \left(\ \sum_{l\ne k} \frac{\bm r_k - \bm r_l}{r_{kl}} \partial u'_{kl} \right)^2 \\
&+ \sum_{l\ne k} \left( \frac{d-1}{r_{kl}}   u'_{kl} +   u{''}_{kl} \right)
\end{split}
\end{align}
Expanding the third term, re-arranging, and inserting $d=3$;
\begin{align}
\begin{split}
\frac{1}{\Psi_T(\mathbf{r})} \nabla_k^2\Psi_T(\mathbf{r}) 
&=
\frac{\nabla_k^2 \phi_k}{\phi_k} + 2  \frac{\nabla_k \phi_k}{\phi_k} \sum_{l\ne k}\frac{\bm r_k - \bm r_l}{r_{kl}}  u'_{kl}  \\
&+  \sum_{j\ne k} \sum_{l\ne k} \frac{(\bm r_k - \bm r_l)(\bm r_k - \bm r_j)}{r_{kj} r_{kl} }  u'_{kj}  u'_{kl} \\
&+ \sum_{l\ne k} \left(   u{''}_{kl} + \frac{2}{r_{kl}}   u'_{kl} \right)
\end{split}
\end{align}

For the drift Force;
Using \eqref{eq:A1_gradpsi}, the drift force of for particle $k$ in the interacting system
\begin{equation*}
F_k = \frac{2\nabla \Psi_T}{\Psi_T}= 2 \left(\ \frac{\nabla_k \phi_k}{\phi_k} + \sum_{l\ne k}\nabla_k u_{kl} \right) 
\end{equation*}

\end{appendices}
\end{document}