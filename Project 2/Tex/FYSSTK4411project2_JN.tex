   \documentclass[%
oneside,                 % oneside: electronic viewing, twoside: printing
final,                   % draft: marks overfull hboxes, figures with paths
10pt]{article}

\listfiles               %  print all files needed to compile this document

\usepackage[a4paper, total={6in, 8in}]{geometry}
\usepackage[totoc]{idxlayout}   % for index in the toc
\usepackage[nottoc]{tocbibind}  % for references/bibliography in the toc

\usepackage{relsize,makeidx,color,setspace,amsmath,amsfonts,amssymb}
\usepackage[table]{xcolor}
\usepackage{bm,ltablex,microtype}
\usepackage{comment} 
\usepackage[pdftex]{graphicx}

\usepackage{fancyvrb} % packages needed for verbatim environments

\usepackage[T1]{fontenc}
%\usepackage[latin1]{inputenc}
\usepackage{ucs}
\usepackage[utf8x]{inputenc}

%extra space in tabs
\usepackage{array}
\setlength{\extrarowheight}{.5ex}


\usepackage{lmodern}         % Latin Modern fonts derived from Computer Modern


\usepackage{pgfplotstable, booktabs}

\pgfplotstableset{
    every head row/.style={before row=\toprule,after row=\midrule},
    every last row/.style={after row=\bottomrule}
}


%Test subsubsubscetion
\usepackage{titlesec}
\usepackage{hyperref}

\titleclass{\subsubsubsection}{straight}[\subsection]

\newcounter{subsubsubsection}[subsubsection]
\renewcommand\thesubsubsubsection{\thesubsubsection.\arabic{subsubsubsection}}
\renewcommand\theparagraph{\thesubsubsubsection.\arabic{paragraph}} % optional; useful if paragraphs are to be numbered

\titleformat{\subsubsubsection}
  {\normalfont\normalsize\bfseries}{\thesubsubsubsection}{1em}{}
\titlespacing*{\subsubsubsection}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{5}{\z@}%
  {3.25ex \@plus1ex \@minus.2ex}%
  {-1em}%
  {\normalfont\normalsize\bfseries}}
\renewcommand\subparagraph{\@startsection{subparagraph}{6}{\parindent}%
  {3.25ex \@plus1ex \@minus .2ex}%
  {-1em}%
  {\normalfont\normalsize\bfseries}}
\def\toclevel@subsubsubsection{4}
\def\toclevel@paragraph{5}
\def\toclevel@paragraph{6}
\def\l@subsubsubsection{\@dottedtocline{4}{7em}{4em}}
\def\l@paragraph{\@dottedtocline{5}{10em}{5em}}
\def\l@subparagraph{\@dottedtocline{6}{14em}{6em}}
\makeatother

\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}
%end of subsubsusbbu


% Hyperlinks in PDF:
\definecolor{linkcolor}{rgb}{0,0,0.4}
\usepackage{hyperref}
\hypersetup{
    breaklinks=true,
    colorlinks=true,
    linkcolor=linkcolor,
    urlcolor=linkcolor,
    citecolor=black,
    filecolor=black,
    %filecolor=blue,
    pdfmenubar=true,
    pdftoolbar=true,
    bookmarksdepth=3   % Uncomment (and tweak) for PDF bookmarks with more levels than the TOC
    }
%\hyperbaseurl{}   % hyperlinks are relative to this root

\setcounter{tocdepth}{2}  % levels in table of contents

% --- fancyhdr package for fancy headers ---
\usepackage{fancyhdr}
\fancyhf{} % sets both header and footer to nothing
\renewcommand{\headrulewidth}{0pt}
\fancyfoot[LE,RO]{\thepage}
% Ensure copyright on titlepage (article style) and chapter pages (book style)
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyfoot[C]{{\footnotesize \copyright\ 1999-2018, "Computational Physics I FYS3150/FYS4150":"http://www.uio.no/studier/emner/matnat/fys/FYS3150/index-eng.html". Released under CC Attribution-NonCommercial 4.0 license}}
%  \renewcommand{\footrulewidth}{0mm}
  \renewcommand{\headrulewidth}{0mm}
}
% Ensure copyright on titlepages with \thispagestyle{empty}
\fancypagestyle{empty}{
  \fancyhf{}
  \fancyfoot[C]{{ }}
  \renewcommand{\footrulewidth}{0mm}
  \renewcommand{\headrulewidth}{0mm}
}

\pagestyle{fancy}


% prevent orhpans and widows
\clubpenalty = 10000
\widowpenalty = 10000

% --- end of standard preamble for documents ---


% insert custom LaTeX commands...

\raggedbottom
\makeindex
\usepackage[totoc]{idxlayout}   % for index in the toc
\usepackage[nottoc]{tocbibind}  % for references/bibliography in the toc
\usepackage{listings}
\usepackage[normalem]{ulem} 	%for tables
\useunder{\uline}{\ul}{}
\usepackage{hyperref}
\usepackage[section]{placeins} %force figs in section

\usepackage{natbib}

\usepackage[toc,page]{appendix} % appenix
\usepackage{amsmath} % split in align
\usepackage{multirow} %multirow


%-------------------- end preamble ----------------------

\begin{document}

% matching end for #ifdef PREAMBLE

\newcommand{\exercisesection}[1]{\subsection*{#1}}


% ------------------- main content ----------------------



% ----------------- title -------------------------

\thispagestyle{empty}

\begin{center}
{\LARGE\bf
\begin{spacing}{1.25}
BOLTZIEMANMACHINE YO!
\end{spacing}
}
\end{center}

% ----------------- author(s) -------------------------

\begin{center}
{\bf Johan Nereng}
\end{center}

    \begin{center}
% List of all institutions:
\centerline{{\small Department of Physics, University of Oslo, Norway}}
\end{center}
    
% ----------------- end author(s) -------------------------

% --- begin date ---
\begin{center}
Spring, 2020
\end{center}
% --- end date ---

\vspace{3cm}
\vspace{3cm}
\begin{abstract}
her kjem det greier
\end{abstract}


\newpage


\textit{\textbf{Author's comments:} Lalalla}
\newpage


\section{Introduction}
 method and the "automated blocking" algorithm from \citep{Jonsson}.

 
In order to write this project paper and the code required to produce the results, I used a variety of tools, including: C++, Python 3.7.7, NumPy \cite{numpy}, as well as a number of books, web-pages and articles - of which most are listed under 
 \hyperref[refer]{references}. All the code required to reproduce the results may be found on my \href{https://github.com/johanere/FYS4411}{github page }.  
 
\section{Material and methods} \label{theory}


\subsection{System: Electrons in 2D isotropic HO}
The system consists of $P$ electrons in a $D$ dimensional isotropic harmoinc oscillator (HO) potential, with the following idealized total Hamiltonian, when using natural units, ($\hbar=c=e=m_e=1$), and energies in  atomic units a.u:
\begin{equation}
\label{eq:finalH}
H=\sum_{i=1}^{P} \left(  -\frac{1}{2} \nabla_i^2 + \frac{1}{2} \omega^2r_i^2  \right)+\sum_{i=1}^P \sum_{j=1}^i \frac{1}{r_{ij}},
\end{equation}
Where $\omega$ is the oscillator frequency  $\omega$, $r_{ij}=\vert \bm{r}_1-\bm{r}_2\vert$, and $r_i = \sqrt{r_{i_x}^2+r_{i_y}^2}$.  Furthermore,
\begin{equation*}
\hat{H}_0=\sum_{i=1}^{P} \left(  -\frac{1}{2} \nabla_i^2 + \frac{1}{2} \omega^2r_i^2  \right),
\end{equation*}
is the standard HO part of the Hamiltonian, while
\begin{equation*}
\hat{H}_1=\sum_{i<j}\frac{1}{r_{ij}},
\end{equation*}
is the interactive part, where $r_{ij}=\vert \bm{r}_1-\bm{r}_2\vert$, and $r_i = \sqrt{r_{i_x}^2+r_{i_y}^2}$.

\subsection{Boltzmann}

\subsubsection{Wave Function}
Using $M=DP$ visible nodes, and $N$ hidden nodes;

\begin{align*}
\Psi (\mathbf{X}) &= F_{rbm}(\mathbf{X}) \\
&= \frac{1}{Z}\sum_{\{h_j\}} e^{-E(\mathbf{X}, \mathbf{h})} \\
&= \frac{1}{Z} \sum_{\{h_j\}} e^{-\sum_i^M \frac{(X_i - a_i)^2}{2\sigma^2} + \sum_j^N b_j h_j + \sum_{i,j}^{M,N} \frac{X_i w_{ij} h_j}{\sigma^2}} \\
&= \frac{1}{Z} e^{-\sum_i^M \frac{(X_i - a_i)^2}{2\sigma^2}} \prod_j^N (1 + e^{b_j + \sum_i^M \frac{X_i w_{ij}}{\sigma^2}}) \\
\end{align*}

Så det går litt kjappere:
\begin{equation}
\begin{aligned}
v(\bm X,j) = b_j + \sum_{i=1}^M \frac{X_i W_{ij} }{\sigma^2}
\end{aligned}
\label{eq:v_j}
\end{equation}

Så:

\begin{equation}
\begin{aligned}
\Psi (\mathbf{X}) = \frac{1}{Z} e^{-\sum_i^M \frac{(X_i - a_i)^2}{2\sigma^2}} \prod_j^N (1 + e^{v(\bm X,j)})
\end{aligned}
\label{eq:TWF}
\end{equation}

\subsubsection{Local Energy}
When using the Monte Carlo methods described later, the particles will be moved one at a time. After each such move, the local energy \eqref{eq:locale} will be evaluated, and used to calculate the ground energy of the system. 
 
\begin{equation}
    E_L(\mathbf{r})=\frac{1}{\Psi_T(\mathbf{r})}H\Psi_T(\mathbf{r}).
    \label{eq:locale}
 \end{equation}
 
As the algorithms will involve repeatedly calculating the local energy, every reduction of floating point operations (FLOPs) involved in doing so will lead to a significant speed up - which is why an analytic expression for the local energy is desirable. Using the trial wave function \eqref{eq:TWF}, and \eqref{eq:locale} (see \hyperref[APP_2:le_1]{Appendix 1: Analytic expression for the local energy}):

\textbf{Non-interacting, using $H=H_0$}
\begin{equation}
\begin{aligned}
E_L(\mathbf{r})&=\frac{1}{\Psi_T(\mathbf{r})}   \sum_{i=1}^{M} \left(  -\frac{1}{2} \nabla_i^2 + \frac{1}{2} \omega^2r_i^2  \right) \Psi_T(\mathbf{r}) + \frac{1}{\Psi_T(\mathbf{r})}  \sum_{i<j}\frac{1}{r_{ij}}  \Psi_T(\mathbf{r}) \\
&=\frac{1}{\Psi_T(\mathbf{r})}   \sum_{i=1}^{M} \left(  -\frac{1}{2} \nabla_i^2 \Psi_T(\mathbf{r})\right) + \sum_{i=1}^{M} \frac{1}{2} \omega^2r_i^2    +  \sum_{i<j}\frac{1}{r_{ij}}  
\end{aligned}
\label{eq:Appendix_rewrite}
\end{equation}
Since
\begin{equation}
\begin{aligned}
\frac{1}{\Psi_T}\nabla^2 \Psi_T & = (\nabla \ln \Psi_T)^2 + \nabla^2 \ln \Psi_T
\end{aligned}
\label{eq:Appendix_rewrite}
\end{equation}
$E_L$ equals
\begin{equation}
\begin{aligned}
E_L(\mathbf{r})
&= -\frac{1}{2}  \sum_{k=1}^{M} \left( \nabla \ln \Psi_T)^2 + \nabla^2 \ln \Psi_T \right) + \sum_{k=1}^{M} \frac{1}{2} \omega^2r_i^2    +  \sum_{i<j}\frac{1}{r_{ij}}  \\
\end{aligned}
\label{eq:Appendix_rewrite}
\end{equation}

Where
\begin{equation}
\begin{aligned}
\frac{1}{\Psi_T} \nabla_k \Psi 
&= - \frac{(X_k - a_k)}{\sigma^2} + \sum_{j}^N \frac{w_{kj}}{\sigma^2}\frac{1}{1 + e^{-v(\bm X,j)}}
\end{aligned}
\label{eq:Appendix_1derivative}
\end{equation}

and
\begin{equation}
\begin{aligned}
\nabla_k^2  \ln \Psi_T 
  &=
 - \frac{1}{\sigma^2} + \sum_{j}^N \frac{w_{kj}^2}{\sigma^4}\frac{e^{-v(\bm X,j)}}{ ( 1 + e^{-v(\bm X,j)} )^2}  
\end{aligned}
\label{eq:Appendix_2derivative}
\end{equation}

\textbf{Interacting, using $H=H_0+H_1$}

As will be discussed more under \hyperref[importance_sampling]{importance sampling}, the drift force of the  particles are also needed;

\begin{equation}
F_i = \frac{2\nabla \Psi_T}{\Psi_T} = 2 \left[- \frac{(X_k - a_k)}{\sigma^2} + \sum_{i}^N \frac{w_{kj}}{\sigma^2}\frac{1}{1 + e^{-v(\bm X,j)}} \right]
\end{equation} 



\subsubsection{Force}

\begin{equation}
F_i = \frac{2\nabla \Psi_T}{\Psi_T}= =2 \nabla_i \ln \Psi_T
\end{equation}


\subsubsection{neste greie}

In this project  we will deal only with a system of
two electrons in a quantum dot with a frequency of $\hbar\omega = 1$. 
The reason for this is that we have exact closed form expressions 
for the ground state energy from Taut's work for selected values of $\omega$, 
see M. Taut, Phys. Rev. A \textbf{48}, 3561 (1993).
The energy is given by $3$ a.u.  (atomic units) when the interaction between the electrons is included. We can however easily extend our system to say interacting bosons as in project 1.

If only the harmonic oscillator part of the Hamiltonian is included,
the so-called unperturbed part,
\begin{equation*} 
\hat{H}_0=\sum_{i=1}^{N} \left(  -\frac{1}{2} \nabla_i^2 + \frac{1}{2} \omega^2r_i^2  \right),
\end{equation*}
the energy is $2$ a.u.
The wave function for one electron in an oscillator potential in two dimensions is
\begin{equation*}
\phi_{n_x,n_y}(x,y) = A H_{n_x}(\sqrt{\omega}x)H_{n_y}(\sqrt{\omega}y)\exp{(-\omega(x^2+y^2)/2}.
\end{equation*}
The functions $H_{n_x}(\sqrt{\omega}x)$ are so-called Hermite polynomials  while $A$ is a normalization constant. 
For the lowest-lying state we have $n_x=n_y=0$ and an energy $\epsilon_{n_x,n_y}=\omega(n_x+n_y+1) = \omega$.
Convince yourself that the lowest-lying energy for the two-electron system  is simply $2\omega$.

The unperturbed wave function for the ground state of the two-electron system is given by
\begin{equation*}
\Phi(\bm{r}_1,\bm{r}_2) = C\exp{\left(-\omega(r_1^2+r_2^2)/2\right)},
\end{equation*}
with $C$ being a normalization constant and $r_i = \sqrt{r_{i_x}^2+r_{i_y}^2}$. Note that the vector $\bm{r}_i$ 
refers to the $x$ and $y$ position for a given particle.
What is the total spin of this wave function? Find arguments for why the ground state should have
this specific total spin. 


\subsection{Algorithms}
Trene en RBM til å foreslå en god $\Psi$ slik at variational principle gir et godt estimat på $E_0$, det vil si lavest mulig - altså et tak. 

Den foreslår en spesfik boltzmann distribusjon. Hvorfor er det riktig? Foreslår masse posisjoner ??

Hva er poenget med maskinen? Skjønner ikke

Gi $d \times n$ $x_i$ 
Interacting vs non-interacting?
\begin{itemize}
\item Initiate positions $X$, weights $W$, and biases $b$ and $a$
\item Use $X$ as positions for $VMC$
\subitem When moving a particle, change $d$ weights that are "coupled" (one particle)
\subitem Sample some stuff
\subitem Estimate $E$
\item Use the stuff and $E$ estimate to adjust $W,b,a$
\item Repeat.
\end{itemize}



\section{Results} \label{results}
\subsection{Non-interacting Boson gas}

\section{Conclusions} \label{conclusions}


\bibliography{ref} \label{refer}
\bibliographystyle{plain}


\begin{appendices}
\section{Appendix 1.} \label{APP_1}
\begin{align*}
\Psi (\mathbf{X}) &= F_{rbm}(\mathbf{X}) \\
&= \frac{1}{Z}\sum_{\{h_j\}} e^{-E(\mathbf{X}, \mathbf{h})} \\
&= \frac{1}{Z} \sum_{\{h_j\}} e^{-\sum_i^M \frac{(X_i - a_i)^2}{2\sigma^2} + \sum_j^N b_j h_j + \sum_{i,j}^{M,N} \frac{X_i w_{ij} h_j}{\sigma^2}} \\
&= \frac{1}{Z} e^{-\sum_i^M \frac{(X_i - a_i)^2}{2\sigma^2}} \prod_j^N (1 + e^{b_j + \sum_i^M \frac{X_i w_{ij}}{\sigma^2}}) \\
\end{align*}
\subsection{Analytic expression for the local energy}
\begin{equation}
\begin{aligned}
E_L=\frac{1}{\Psi_T}\hat H \Psi_T = \sum_{i=1}^N -\frac{1}{2} \frac{1}{\Psi_T} \nabla^2 \Psi_T + \frac{1}{2}\omega^2r_i^2)
\end{aligned}
\label{eq:Appendix_localenergy}
\end{equation}
Where
\begin{equation}
\begin{aligned}
\frac{1}{\Psi_T}\nabla^2 \Psi_T &=  \frac{1}{\Psi_T}\nabla (\Psi _T \frac{1}{\Psi_T} \nabla \frac{1}{\Psi_T})\\
&= (\frac{1}{\Psi_T} \nabla \Psi_T) ^2 + \nabla (\frac{1}{\Psi_T}\nabla \Psi_T)\\ 
&= (\nabla \ln \Psi_T)^2 + \nabla^2 \ln \Psi_T
\end{aligned}
\label{eq:Appendix_rewrite}
\end{equation}

First derivative:
\begin{equation}
\begin{aligned}
\frac{1}{\Psi_T} \nabla_k \Psi &= \nabla_k  \ln \Psi_T \\
&= \nabla_k  \big( \ln \frac{1}{Z}  -\sum_i^M \frac{(X_i - a_i)^2}{2\sigma^2} +  \sum_j^N \ln (1 + e^{ b_j + \sum_i^M \frac{X_i w_{ij}}{\sigma^2}}) \big) \\
&= 
  - \frac{(X_k - a_k)}{\sigma^2} + \sum_{j}^N w_{kj}\frac{\exp (b_j + \sum_i^M \frac{x_i w_{ij}}{\sigma^2})}{1 + e^{ b_j + \sum_i^M \frac{X_i w_{ij}}{\sigma^2}}}  \\
&= - \frac{(X_k - a_k)}{\sigma^2} + \sum_{j}^N \frac{w_{kj}}{\sigma^2}\frac{1}{1 + e^{-v(\bm X,j)}}
\end{aligned}
\label{eq:Appendix_1derivative}
\end{equation}

Second derivative:
\begin{equation}
\begin{aligned}
\nabla_k^2  \ln \Psi_T &= \nabla_k  \big( 
   - \frac{(X_k - a_k)}{\sigma^2} + \sum_{j}^N \frac{w_{kj}}{\sigma^2}\frac{1}{1 + e^{-b_j  -\sum_i^M \frac{X_i w_{ij}}{\sigma^2}}}  \big) \\
  &=
 - \frac{1}{\sigma^2} + \sum_{j}^N \frac{w_{kj}^2}{\sigma^4}\frac{e^{-v(\bm X,j)}}{ ( 1 + e^{-v(\bm X,j)} )^2}  
\end{aligned}
\label{eq:Appendix_2derivative}
\end{equation}

Thus to calculate \eqref{eq:Appendix_localenergy}, one may use \eqref{eq:Appendix_rewrite}, \eqref{eq:Appendix_1derivative} and \eqref{eq:Appendix_2derivative}.


\end{appendices}



\end{document}